# 실험 사용법 가이드

## 전체 워크플로우

```
1. Gemini 생성 AI 증강 (gen_ai)
2. 라벨링 서버로 어노테이션 작성
3. 전통 증강 (traditional_aug)
4. 데이터셋 병합 (merge_dataset.py)
5. 모델 학습 & 평가
```

---

## 1. 생성 AI 증강 (Gemini)

**작업 경로**: `scripts/augmentation/`

```bash
cd /home/jjh0709/gitrepo/VISION-Instance-Seg/scripts/augmentation

# 백그라운드 실행 (세 카테고리 동시)
nohup python -u gemini_augment.py casting_Inclusoes > casting_Inclusoes.log 2>&1 &
nohup python -u gemini_augment.py casting_Rechupe   > casting_Rechupe.log   2>&1 &
nohup python -u gemini_augment.py screw_defect      > screw_defect.log      2>&1 &

# 진행 확인
tail -f screw_defect.log
```

생성된 이미지 위치: `data_augmented/{Category}/gen_ai/images/`

---

## 2. 라벨링 서버 (어노테이션)

```bash
cd /home/jjh0709/gitrepo/VISION-Instance-Seg

# 전체 카테고리 (기본)
nohup python labeling_server/app.py --port 5198 > labeling_server/labeling.log 2>&1 &

# 특정 카테고리만
python labeling_server/app.py --category Screw --port 5199
```

접속: `http://lifeai.suwon.ac.kr:5198`

저장 위치: `data_augmented/{Category}/gen_ai/annotations.json`

---

## 3. 전통 증강

**작업 경로**: 프로젝트 루트

```bash
cd /home/jjh0709/gitrepo/VISION-Instance-Seg

# 기본 (원본 train 데이터에서 증강)
python scripts/augmentation/traditional_augment.py \
    --category Screw   --n_augment 2750 --seed 42

python scripts/augmentation/traditional_augment.py \
    --category Casting --n_augment 2750 --seed 42

python scripts/augmentation/traditional_augment.py \
    --category Cable   --n_augment 2750 --seed 42

# 백그라운드 실행
nohup python -u scripts/augmentation/traditional_augment.py \
    --category Screw --n_augment 2750 --seed 42 \
    > scripts/augmentation/screw_trad.log 2>&1 &
```

생성된 이미지 위치: `data_augmented/{Category}/traditional_aug/images/`

### 커스텀 입출력 (실험 조건 5용)
```bash
# 원본 + gen_ai 합친 데이터에서 전통 증강 (조건 5)
python scripts/augmentation/traditional_augment.py \
    --category Screw \
    --input_dir /path/to/merged/images \
    --ann_file  /path/to/merged/annotations.json \
    --output_dir /path/to/output \
    --n_augment 2750 \
    --seed 42
```

---

## 4. 실험 2: 전통 증강 vs 생성 AI 비교

### 조건 정의

| 조건  | 구성                               | 총 데이터 |
|-------|-----------------------------------|----------|
| cond1 | 원본 25                            | 25       |
| cond2 | 원본 25 + 전통 250                 | 275      |
| cond3 | 원본 25 + gen_ai 250               | 275      |
| cond4 | 원본 25 + gen_ai 250 + 전통 250    | 525      |
| cond5 | 원본 25 + gen_ai 250 + 전통 2,750  | 3,025    |

### 데이터셋 병합

```bash
cd /home/jjh0709/gitrepo/VISION-Instance-Seg

# 조건 1: 원본만
python scripts/data_utils/merge_dataset.py \
    --category all --condition cond1

# 조건 2: 원본 + 전통 250
python scripts/data_utils/merge_dataset.py \
    --category all --condition cond2

# 조건 3: 원본 + gen_ai 250
python scripts/data_utils/merge_dataset.py \
    --category all --condition cond3

# 조건 4: 원본 + gen_ai 250 + 전통 250
python scripts/data_utils/merge_dataset.py \
    --category all --condition cond4

# 조건 5: 원본 + gen_ai 250 + 전통 2750
python scripts/data_utils/merge_dataset.py \
    --category all --condition cond5

# 특정 카테고리만, 이미지 수 커스텀
python scripts/data_utils/merge_dataset.py \
    --category Screw \
    --condition cond3 \
    --n_original 25 \
    --n_genai 200 \
    --seed 42
```

출력 위치: `results/experiment2/{Category}/{condition}/`
```
results/experiment2/
└── Screw/
    ├── cond1/
    │   ├── images/
    │   └── annotations.json
    ├── cond2/
    ├── cond3/
    ├── cond4/
    └── cond5/
```

---

## 5. 실험 1: 생성 AI 증강 수에 따른 성능 변화

| 조건       | 원본 | gen_ai | 합계 |
|-----------|------|--------|------|
| Baseline  | 25   | 0      | 25   |
| +50       | 25   | 50     | 75   |
| +100      | 25   | 100    | 125  |
| +150      | 25   | 150    | 175  |
| +200      | 25   | 200    | 225  |
| +250      | 25   | 250    | 275  |

```bash
# 예시: +50 조건
python scripts/data_utils/merge_dataset.py \
    --category Screw \
    --condition cond3 \
    --n_original 25 \
    --n_genai 50 \
    --output_dir results/experiment1/n50

# 예시: +250 조건
python scripts/data_utils/merge_dataset.py \
    --category Screw \
    --condition cond3 \
    --n_original 25 \
    --n_genai 250 \
    --output_dir results/experiment1/n250
```

---

## 6. 어노테이션 검수 (Jupyter)

```bash
cd /home/jjh0709/gitrepo/VISION-Instance-Seg
jupyter notebook scripts/inspect_annotation.ipynb
```

Cell 2에서 파일명 지정 → 자동으로 annotations.json 찾아 시각화

---

## 7. 데이터 통계 확인

```bash
# 노트북에서 (Cell 5)
jupyter notebook scripts/inspect_annotation.ipynb

# 직접 확인
python -c "
import json; from pathlib import Path
base = Path('data_augmented')
for cat in ['Cable','Screw','Casting']:
    for split in ['gen_ai','traditional_aug']:
        p = base/cat/split/'annotations.json'
        if p.exists():
            d = json.load(open(p))
            print(f'{cat}/{split}: {len(d[\"images\"])}장, {len(d[\"annotations\"])}개')
"
```

---

## 8. 현재 상태 확인

```bash
# 백그라운드 프로세스 확인
ps aux | grep python | grep -v grep

# 생성 진행 로그
tail -f scripts/augmentation/screw_defect.log
tail -f scripts/augmentation/casting_Inclusoes.log
tail -f scripts/augmentation/casting_Rechupe.log
tail -f scripts/augmentation/screw_trad.log
tail -f scripts/augmentation/casting_trad.log

# 이미지 수 확인
ls data_augmented/Screw/gen_ai/images/ | wc -l
ls data_augmented/Screw/traditional_aug/images/ | wc -l
ls data_augmented/Casting/gen_ai/images/ | wc -l
```
